\subsection{Proof of Theorem \ref{thm:relative-prog}}
\label{sec:progress-proof}
We proceed by structural induction on $\choremptyped{C_1}{\tau}$.
\begin{description}
  \item[\textsc{Done}]
  Let $C = L.e_1$.
  By \textsc{Local Progress}, either $e_1$ is a value, or there is some $e_2$ such that $e_1 \localstep e_2$.
  In the former, $L.e_1$ is a value.
  In the latter, $L.e_1 \step{\RDone{L}{e_1}{e_2}} L.e_2$ by \textsc{DoneE}.

  \item[\textsc{Fun}]
  Let $C = \Fun{F}{X \ty \tau}{C_1}$.
  By definition, $\Fun{F}{X \ty \tau}{C_1}$ is a value.

%  \item[\textsc{Rec}]
%  Let $C = \Rec{X \ty \tau}{C_1}$.
%  By \textsc{Rec}, $\Rec{X \ty \tau}{C_1} \step{\RRec} \subst{C}{X}{\Rec{X \ty \tau}{C_1}}$ can always step.

  \item[\textsc{App}]
    \ethan{Fix this for recursive functions!}
  Let $C = C_1~C_2$.
  By induction, either $C_1$ is a value or can step to some $C_2$.
  In the latter, if $C_1 \step{R} C_1'$, then $C_1~C_2 \step{\RFun{R}} C_1'~C_2$ by \textsc{AppFun}.
  Now suppose $C_1$ is a value.
  If $C_2 \step{R} C_2'$, then $C_1~C_2 \step{\RArg{R}} C_1~C_2'$ by \textsc{AppArg}.
  Otherwise suppose $C_2$ is also a value.
  Because $C_1$ is a value, it must be of the form $C_1 = \Fun{F}{X \ty \tau}{C_1'}$.
  Therefore $C_1~C_2 \step{\RApp} \subst*{C_1'}{{F}{C_1}{X}{C_2}}$ by \textsc{App}.

  \item[\textsc{Send}]
  Let $C = C_1 \ChorSend[L_1] L_2$.
  By induction, either $C_1$ is a value or $C_1 \step{R} C_1'$.
  In the former, $C_1 = L_1.v$, and so $L_1.v \ChorSend[L_1] L_2 \step{\RSendV{L_1}{v}{L_2}} L_2.v$.
  If $C_1 \step{R} C_1'$, then $C_1 \ChorSend[L_1] L_2 \step{\RSend{R}{L_1}} C_1' \ChorSend[L_1] L_2$ by \textsc{Send}.

  \item[\textsc{Sync}]
  Let $C = \syncs{L_1}{d}{L_2} \seq C_1$.
  By \textsc{Sync}, $\syncs{L_1}{d}{L_2} \seq C_1 \step{\RSync{L_1}{d}{L_2}} C_1$.

  \item[\textsc{ITE}]
  Let $C = \ITE{C_1}{C_2}{C_3}$.
  We can apply induction to $C_1$.
  If $C_1 \step{R} C_1'$, then $\ITE{C_1}{C_2}{C_3} \step{\RIf{L}{R}} \ITE{C_1'}{C_2}{C_3}$ by $\textsc{If}$.
  Otherwise if $C_1$ is a value, it is either $L.\True$ or $L.\False$ by \textsc{Boolean Inversion}, and hence $\ITE{L.\True}{C_2}{C_3} \step{\RIfTrue{L}} C_2$ or $\ITE{L.\False}{C_2}{C_3} \step{\RIfFalse{L}} C_3$ respectively, by \textsc{IfT} or \textsc{IfF}.

  \item[\textsc{TAbs}]
  Let $C = \TFun{\alpha \knd \kappa}{C_1}$.
  By definition, $\TFun{\alpha \knd \kappa}{C_1}$ is a value.

  \item[\textsc{TApp}]
  Let $C = C_1~t$.
  We can apply induction to $C_1$.
  If $C_1 \step{R} C_1'$, then $C_1~t \step{\RFun{R}} C_1'~t$ by \textsc{TAppFun}.
  Otherwise if $C_1$ is a value, it must be of the form $\TFun{\alpha \knd \kappa}{C_1'}$.
  Therefore $(\TFun{\alpha \knd \kappa}{C_1'})~t \step{\RTApp} \subst{C_1'}{\alpha}{t}$ by \textsc{TApp}.

  \item[\textsc{DefLocal}]
  Let $C = \LetIn{L.x \ty t_e}{C_1}{C_2}$.
  We can apply induction to $C_1$.
  If $C_1 \step{R} C_1'$, then $\LetIn{L.x \ty t_e}{C_1}{C_2} \step{\RArg{R}} \LetIn{L.x \ty t_e}{C_1'}{C_2}$ by \textsc{LocalLetArg}.
  Otherwise if $C_1$ is a value, it must be of the form $L.v$, where $v$ is a value.
  Therefore $\LetIn{L.x \ty t_e}{L.v}{C_2} \step{\RLet{L}{v}} \subst{C_2}{L.x}{v}$ by \textsc{LocalLet}.

  \item[\textsc{TellLetLoc}]
  Let $C = \LetTellIn{\alpha \knd *_\ell}{L}{C_1}{\rho}{C_2}$.
  We can apply induction to $C_1$.
  If $C_1 \step{R} C_1'$, then $\LetTellIn{\alpha \knd *_\ell}{L}{C_1}{\rho}{C_2} \step{\RArg{R}} \LetTellIn{\alpha \knd *_\ell}{L}{C_1'}{\rho}{C_2}$ by \textsc{TellLetArg}.
  Otherwise if $C_1$ is a value, it must be of the form $L.v$, where $v$ is a value.
  By \textsc{Location Inversion}, there is some $L' \in \Locations$ such that $v = \say{L'}$.
  Therefore $\LetTellIn{\alpha \knd *_\ell}{L}{L.v}{\rho}{C} \step{\RTellLet{L}{L'}{\rho}} \subst{C}{\alpha}{L'}$ by \textsc{TellLet}.

  \item[\textsc{TellLetTyp}]
  Let $C = \LetTellIn{\alpha \knd *_e}{L}{C_1}{\rho}{C_2}$.
  We can apply induction to $C_1$.
  If $C_1 \step{R} C_1'$, then $\LetTellIn{\alpha \knd *_e}{L}{C_1}{\rho}{C_2} \step{\RArg{R}} \LetTellIn{\alpha \knd *_e}{L}{C_1'}{\rho}{C_2}$ by \textsc{TellLetArg}.
  Otherwise if $C_1$ is a value, it must be of the form $L.v$, where $v$ is a value.
  By \textsc{Type Inversion}, there is some local type $t$ such that $\localempkinded{t}$ and $v = \say{t}$.
  Therefore $\LetTellIn{\alpha \knd *_e}{L}{L.v}{\rho}{C} \step{\RTellLet{L}{t}{\rho}} \subst{C}{\alpha}{t}$ by \textsc{TellLet}.
\end{description}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "conference"
%%% End:
