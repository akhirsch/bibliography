\subsection{Endpoint Projection}
\label{sec:proj-def}

Note, in the following definitions, $\AmI{\ell}{E_1}{E_2}$ is used as shorthand for $\AmIIn{\{\ell\}}{E_1}{E_2}$.

\begin{mathparpagebreakable}
  \epp{X}{L} = X
  \and
  \epp{\ell.e}{L} =
    \begin{cases}
      \Ret{e} & L = \ell \\
      \CtrlFail & L \neq \ell
  \end{cases}
  \and
  \epp{\Fun{F}{X \ty \tau}{C}}{L} = \CtrlFun{F}{X}{\epp{C}{L}}
%  \and
%  \epp{\Rec{X \ty \tau}{C}}{L} = \CtrlRec{X}{\epp{C}{L}}
  \and
  \epp{C_1~C_2}{L} = \epp{C_1}{L}~\epp{C_2}{L}
  \and
  \epp{C \ChorSend[\ell_1] \ell_2}{L} =
    \begin{cases}
      \epp{C}{L} & L = \ell_1 = \ell_2 ~\text{or}~ L \neq \ell_1, \ell_2 \\
      \SendTo{\epp{C}{L}}{\{\ell_2\}} & L = \ell_1 \neq \ell_2 \\
      \RecvFrom{\ell_1} & L = \ell_2 \neq \ell_1
    \end{cases}
  \and
  \epp{\syncs{\ell_1}{d}{\ell_2} \seq C}{L} =
    \begin{cases}
      \epp{C}{L} & L = \ell_1 = \ell_2 ~\text{or}~ L \neq \ell_1, \ell_2 \\
      \ChooseFor{d}{\ell_2}{\epp{C}{L}} & L = \ell_1 \neq \ell_2 \\
      \AllowChoice{\ell_1}{\epp{C}{L}}{\CtrlNone} & L = \ell_2 \neq \ell_1 ~\text{and}~ d = \Left \\
      \AllowChoice{\ell_1}{\CtrlNone}{\epp{C}{L}} & L = \ell_2 \neq \ell_1 ~\text{and}~ d = \Right
    \end{cases}
  \and
  \epp{\ITE{C}{C_1}{C_2}}{L} =
    \begin{cases}
      \CtrlITE{\epp{C}{L}}{\epp{C_1}{L}}{\epp{C_2}{L}} & L = \ell \\
      \epp{C}{L} \CtrlSeq \epp{C_1}{L} \ctrlmerge \epp{C_2}{L} & L \neq \ell
    \end{cases}
  \and
  \epp{\TFun{\alpha \knd \kappa}{C}}{L} = \begin{cases}
    \CtrlTFun{\alpha}{\AmI{\alpha}{\epp{\subst{C}{\alpha}{L}}{L}}{\epp{C}{L}}} & \text{if}~\kappa = *_\ell \\
    \CtrlTFun{\alpha}{\AmIIn{\alpha}{\epp{\subst{C}{\alpha}{\alpha \cup \{L\}}}{L}}{\epp{C}{L}}} & \text{if}~\kappa = *_s \\
    \CtrlTFun{\alpha}{\epp{C}{L}} & \text{otherwise}
  \end{cases}
  \and
  \epp{C~t}{L} = \epp{C}{L}~t
  \and
  \epp{\LetIn{\ell.x \ty t_e}{C_1}{C_2}}{L} =
    \begin{cases}
      \CtrlLetIn{\Ret{x}}{\epp{C_1}{L}}{\epp{C_2}{L}} & L = \ell \\
      \epp{C_1}{L} \CtrlSeq \epp{C_2}{L} & L \neq \ell
    \end{cases}
  \and
  \addtocounter{numlevels}{1}
  \epp{\LetTellIn{\alpha \knd *_\ell}{\ell}{C_1}{\rho}{C_2}}{L} =
    \begin{cases}
      \begin{array}{@{}l@{}}
        \CtrlLetIn{\alpha}{\epp{C_1}{L}}{} \\
        \quad \SendTo{\alpha}{\rho} \CtrlSeq \\
        \quad\AmI{\alpha}{\epp{\subst{C_2}{\alpha}{L}}{L}}{\epp{C_2}{L}}
      \end{array} & L = \ell \vspace{1ex}\\
      \begin{array}{@{}l@{}}
      \epp{C_1}{L} \CtrlSeq
          \CtrlLetIn*{\alpha}{\RecvFrom{\ell}}
          {\AmI*{\alpha}{\epp{\subst{C_2}{\alpha}{L}}{L}}{\epp{C_2}{L}}}
      \end{array}
      & L \neq \ell ~\text{and}~ L \in \rho \vspace{1ex}\\
      \epp{C_1}{L} \CtrlSeq \epp{C_2}{L}
        & \makebox[\widthof{$L \neq \ell ~\text{and}~ L \in \rho$}][r]{
          $L \neq \ell$ and $L \notin \rho$ and $\alpha \notin \fv(\epp{C_2}{L})$}
    \end{cases}
  \addtocounter{numlevels}{-1}
  \and
  \epp{\LetTellIn{\alpha \knd *_e}{\ell}{C_1}{\rho}{C_2}}{L} =
    \begin{cases}
      \CtrlLetIn{\alpha}{\epp{C_1}{L}}{(\SendTo{\alpha}{\rho} \CtrlSeq \epp{C_2}{L})} & L = \ell \vspace{1ex}\\
%      \LetSendIn{\alpha}{\epp{C_1}{L}}{\rho}{\epp{C_2}{L}} & L = \ell \\
      \begin{array}{@{}l@{}}
        \epp{C_1}{L} \CtrlSeq \CtrlLetIn{\alpha}{(\RecvFrom{\ell})}{} \\
        \quad \SendTo{\alpha}{\rho} \CtrlSeq \epp{C_2}{L}
      \end{array}
      & L \neq \ell ~\text{and}~ L \in \rho \vspace{1ex}\\
%      \epp{C_1}{L} \CtrlSeq \LetRecvIn{\alpha}{\ell}{\epp{C_2}{L}} & L \neq \ell ~\text{and}~ L \in \rho \\
      \epp{C_1}{L} \CtrlSeq \epp{C_2}{L}
        & \makebox[\widthof{$L \neq \ell ~\text{and}~ L \in \rho$}][r]{
          $L \neq \ell$ and $L \notin \rho$ and $\alpha \notin \fv(\epp{C_2}{L})$}
    \end{cases}
\end{mathparpagebreakable}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "conference"
%%% End:
